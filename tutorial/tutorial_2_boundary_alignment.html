<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Alignment of TAD boundaries &mdash; Tadbit 0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/forkme_nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/black-on-white.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../_static/TADbit_icon.ico"/>
    <link rel="top" title="Tadbit 0.1 documentation" href="../index.html" />
    <link rel="up" title="Tutorials" href="../tutorial.html" />
    <link rel="next" title="TAD clustering" href="tutorial_3_clustering.html" />
    <link rel="prev" title="Getting started" href="tutorial_1_general.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="tutorial_3_clustering.html" title="TAD clustering"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="tutorial_1_general.html" title="Getting started"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Tadbit 0.1 documentation</a> &raquo;</li>
          <li><a href="../tutorial.html" accesskey="U">Tutorials</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="alignment-of-tad-boundaries">
<h1><a class="toc-backref" href="#id2">Alignment of TAD boundaries</a><a class="headerlink" href="#alignment-of-tad-boundaries" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#alignment-of-tad-boundaries" id="id2">Alignment of TAD boundaries</a><ul>
<li><a class="reference internal" href="#aligning-boundaries" id="id3">Aligning boundaries</a><ul>
<li><a class="reference internal" href="#check-alignment-consistency-through-randomization" id="id4">Check alignment consistency through randomization</a></li>
</ul>
</li>
<li><a class="reference internal" href="#alignment-objects" id="id5">Alignment objects</a><ul>
<li><a class="reference internal" href="#visualization" id="id6">Visualization</a></li>
<li><a class="reference internal" href="#the-get-column-function" id="id7">The get_column function</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<p>TADbit allows to use the information from different Hi-C experiments and to put it together in order to
decide whether some TAD boundaries are conserved or not.</p>
<p>Following with the example in the previous section (<a class="reference internal" href="tutorial_1_general.html#getting-start"><em>Getting started</em></a>), we will load one extra experiment
(from the same works of <a class="reference internal" href="../biblio.html#lieberman-aiden2009" id="id1">[Lieberman-Aiden2009]</a>):</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pytadbit</span> <span class="kn">import</span> <span class="n">Chromosome</span>

<span class="c"># initiate a chromosome object that will store all Hi-C data and analysis</span>
<span class="n">my_chrom</span> <span class="o">=</span> <span class="n">Chromosome</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;My fisrt chromosome&#39;</span><span class="p">,</span> <span class="n">centromere_search</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># load Hi-C data</span>
<span class="n">my_chrom</span><span class="o">.</span><span class="n">add_experiment</span><span class="p">(</span><span class="s">&#39;First Hi-C experiment&#39;</span><span class="p">,</span> <span class="n">hic_data</span><span class="o">=</span><span class="s">&quot;../../scripts/sample_data/HIC_k562_chr19_chr19_100000_obs.txt&quot;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span>
<span class="n">my_chrom</span><span class="o">.</span><span class="n">add_experiment</span><span class="p">(</span><span class="s">&#39;Second Hi-C experiment&#39;</span><span class="p">,</span> <span class="n">hic_data</span><span class="o">=</span><span class="s">&quot;../../scripts/sample_data/HIC_gm06690_chr19_chr19_100000_obs.txt&quot;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span>

<span class="c"># run core tadbit function to find TADs, on each experiment</span>
<span class="n">my_chrom</span><span class="o">.</span><span class="n">find_tad</span><span class="p">(</span><span class="s">&#39;First Hi-C experiment&#39;</span><span class="p">)</span>
<span class="n">my_chrom</span><span class="o">.</span><span class="n">find_tad</span><span class="p">(</span><span class="s">&#39;Second Hi-C experiment&#39;</span><span class="p">)</span>

<span class="k">print</span> <span class="n">my_chrom</span><span class="o">.</span><span class="n">experiments</span>
</pre></div>
</div>
<pre class="ansi-block literal-block">
[Experiment First Hi-C experiment (resolution: 100Kb, TADs: 37, Hi-C rows: 639, normalized: visibility), Experiment Second Hi-C experiment (resolution: 100Kb, TADs: 34, Hi-C rows: 639, normalized: visibility)]
</pre>
<pre class="ansi-block literal-block">
/usr/local/lib/python2.7/dist-packages/pytadbit/parsers/hic_parser.py:93: UserWarning: WARNING: non integer values
  warn('WARNING: non integer values')
</pre>
<p>We now have loaded two Hi-C experiments, both at 100 Kb resolution, and have predicted the location of TADs in each of them (42 TADs detected in the first experiment and 31 in the second).</p>
<div class="section" id="aligning-boundaries">
<h2><a class="toc-backref" href="#id3">Aligning boundaries</a><a class="headerlink" href="#aligning-boundaries" title="Permalink to this headline">¶</a></h2>
<p>To align TAD boundaries several algorithms have been implemented
(see <a class="reference internal" href="../reference/reference_chromosome.html#pytadbit.chromosome.Chromosome.align_experiments" title="pytadbit.chromosome.Chromosome.align_experiments"><tt class="xref py py-func docutils literal"><span class="pre">pytadbit.chromosome.Chromosome.align_experiments()</span></tt></a>); our recommendation, however, is to use
the default &#8220;reciprocal&#8221; method (<a class="reference internal" href="../reference/reference_aligner.html#pytadbit.boundary_aligner.reciprocally.reciprocal" title="pytadbit.boundary_aligner.reciprocally.reciprocal"><tt class="xref py py-func docutils literal"><span class="pre">pytadbit.boundary_aligner.reciprocally.reciprocal()</span></tt></a>).</p>
<p><em>Note: If the align_experiments function is run with no argument, by default all the loaded experiments will be aligned.</em></p>
<p>Continuing with the example, the two loaded experiments are aligned as follow:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">my_chrom</span><span class="o">.</span><span class="n">align_experiments</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;First Hi-C experiment&quot;</span><span class="p">,</span> <span class="s">&quot;Second Hi-C experiment&quot;</span><span class="p">])</span>

<span class="k">print</span> <span class="n">my_chrom</span><span class="o">.</span><span class="n">alignment</span>
</pre></div>
</div>
<pre class="ansi-block literal-block">
{('First Hi-C experiment', 'Second Hi-C experiment'): Alignment of boundaries (length: 56, number of experiments: 2)}
</pre>
<p>All the alignments done between the experiments belonging to the same chromosome are stored under the
alignment dictionary attached to the Chromosome object. Each alignment is an object itself
(see <a class="reference internal" href="../reference/reference_boundary_alignment.html#pytadbit.alignment.Alignment" title="pytadbit.alignment.Alignment"><tt class="xref py py-class docutils literal"><span class="pre">pytadbit.alignment.Alignment</span></tt></a>)</p>
<div class="section" id="check-alignment-consistency-through-randomization">
<h3><a class="toc-backref" href="#id4">Check alignment consistency through randomization</a><a class="headerlink" href="#check-alignment-consistency-through-randomization" title="Permalink to this headline">¶</a></h3>
<p>In order to check that the alignment makes sense and that it does not correspond to a random association of boundaries, the “randomize” parameter can be set to True when aligning:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">score</span><span class="p">,</span> <span class="n">pval</span> <span class="o">=</span> <span class="n">my_chrom</span><span class="o">.</span><span class="n">align_experiments</span><span class="p">(</span><span class="n">randomize</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">rnd_method</span><span class="o">=</span><span class="s">&quot;interpolate&quot;</span><span class="p">,</span>
                                         <span class="n">rnd_num</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&#39;score:&#39;</span><span class="p">,</span> <span class="n">score</span>
<span class="k">print</span> <span class="s">&#39;p-value:&#39;</span><span class="p">,</span> <span class="n">pval</span>
</pre></div>
</div>
<pre class="ansi-block literal-block">
score: 0.223214285714
p-value: 0.0
</pre>
</div>
</div>
<div class="section" id="alignment-objects">
<h2><a class="toc-backref" href="#id5">Alignment objects</a><a class="headerlink" href="#alignment-objects" title="Permalink to this headline">¶</a></h2>
<div class="section" id="visualization">
<h3><a class="toc-backref" href="#id6">Visualization</a><a class="headerlink" href="#visualization" title="Permalink to this headline">¶</a></h3>
<p>The first function to call to check the quality of the generated alignments is the
<a class="reference internal" href="../reference/reference_boundary_alignment.html#pytadbit.alignment.Alignment.write_alignment" title="pytadbit.alignment.Alignment.write_alignment"><tt class="xref py py-func docutils literal"><span class="pre">pytadbit.alignment.Alignment.write_alignment()</span></tt></a>:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">ali</span> <span class="o">=</span> <span class="n">my_chrom</span><span class="o">.</span><span class="n">alignment</span><span class="p">[(</span><span class="s">&#39;First Hi-C experiment&#39;</span><span class="p">,</span> <span class="s">&#39;Second Hi-C experiment&#39;</span><span class="p">)]</span>

<span class="k">print</span> <span class="n">ali</span>
</pre></div>
</div>
<pre class="ansi-block literal-block">
Alignment shown in 100 Kb (2 experiments) (scores: <span class="ansi-blue">0</span> <span class="ansi-blue">1</span> <span class="ansi-blue">2</span> <span class="ansi-cyan">3</span> 4 <span class="ansi-bold">5</span> <span class="ansi-yellow">6</span> <span class="ansi-yellow">7</span> <span class="ansi-magenta">8</span> <span class="ansi-magenta">9</span> <span class="ansi-red">10</span>)
 First Hi-C experiment:|     <span class="ansi-blue">6</span>|     <span class="ansi-blue">6</span>| ---- |    <span class="ansi-blue">12</span>| ---- | ---- |    <span class="ansi-yellow">32</span>| ---- |    <span class="ansi-bold">46</span>|    <span class="ansi-bold">57</span>|    <span class="ansi-yellow">70</span>| ---- |    <span class="ansi-cyan">83</span>| ---- | ---- |   104|   <span class="ansi-yellow">109</span>| ---- | ---- |   <span class="ansi-yellow">129</span>| ---- | ---- | ---- |   <span class="ansi-yellow">184</span>|   195|   237|   <span class="ansi-bold">245</span>|   330|   348|   <span class="ansi-blue">353</span>| ---- |   <span class="ansi-magenta">378</span>|   <span class="ansi-cyan">384</span>| ---- |   <span class="ansi-yellow">400</span>| ---- |   <span class="ansi-magenta">413</span>| ---- |   <span class="ansi-cyan">433</span>|   <span class="ansi-yellow">446</span>|   472|   <span class="ansi-bold">478</span>|   <span class="ansi-yellow">486</span>| ---- |   <span class="ansi-cyan">501</span>|   <span class="ansi-yellow">506</span>| ---- |   <span class="ansi-blue">522</span>|   <span class="ansi-bold">531</span>|   554|   <span class="ansi-yellow">563</span>|   <span class="ansi-bold">570</span>|   <span class="ansi-yellow">594</span>|   <span class="ansi-yellow">609</span>| ---- |   <span class="ansi-red">639</span>
Second Hi-C experiment:|     <span class="ansi-bold">5</span>| ---- |    <span class="ansi-bold">12</span>| ---- |    <span class="ansi-magenta">18</span>|    <span class="ansi-cyan">28</span>| ---- |    <span class="ansi-yellow">42</span>|    <span class="ansi-cyan">47</span>|    <span class="ansi-yellow">57</span>| ---- |    <span class="ansi-red">79</span>| ---- |    <span class="ansi-bold">86</span>|    <span class="ansi-red">98</span>| ---- | ---- |   <span class="ansi-magenta">115</span>|   126| ---- |   <span class="ansi-bold">131</span>|   <span class="ansi-yellow">145</span>|   164| ---- |   <span class="ansi-magenta">195</span>| ---- |   <span class="ansi-yellow">246</span>| ---- | ---- | ---- |   <span class="ansi-yellow">375</span>| ---- | ---- |   <span class="ansi-yellow">397</span>| ---- |   <span class="ansi-yellow">402</span>|   <span class="ansi-bold">413</span>|   <span class="ansi-yellow">431</span>| ---- | ---- | ---- |   <span class="ansi-magenta">478</span>|   <span class="ansi-magenta">486</span>|   <span class="ansi-yellow">498</span>| ---- | ---- |   <span class="ansi-yellow">510</span>| ---- |   531|   <span class="ansi-red">554</span>|   <span class="ansi-bold">563</span>|   <span class="ansi-yellow">569</span>|   <span class="ansi-yellow">593</span>|   <span class="ansi-red">609</span>|   624|   <span class="ansi-red">639</span>
</pre>
<p>The different colors, corresponding to the TADbit confidence in detecting the boundaries, show how conserved the boundaries are between (in this case) cell types.</p>
<p>Alignment can also be viewed using matplotlib (already mention in <a class="reference internal" href="tutorial_1_general.html#density-plot"><em>TADs in density plots</em></a>):</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">ali</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/tutorial_2_boundary_alignment_17_0.png" src="../_images/tutorial_2_boundary_alignment_17_0.png" />
<p><em>Note that this function can also be zoomed in.</em></p>
</div>
<div class="section" id="the-get-column-function">
<h3><a class="toc-backref" href="#id7">The get_column function</a><a class="headerlink" href="#the-get-column-function" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="../reference/reference_boundary_alignment.html#pytadbit.alignment.Alignment.get_column" title="pytadbit.alignment.Alignment.get_column"><tt class="xref py py-func docutils literal"><span class="pre">pytadbit.alignment.Alignment.get_column()</span></tt></a> function allows to select specific columns of an alignment.</p>
<p>To select, for example, the third column of an alignment:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">ali</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<pre class="ansi-block literal-block">
[(2, [&gt;-&lt;, &gt;1100&lt;])]
</pre>
<p>The first element of the tuple is the column index, while the two values of the second element of the tuple
are the TADs associated to the aligned boundaries in that column. Note that TAD objects are represented
between the &#8216;&gt;&#8217; and &#8216;&lt;&#8217; symbols (see: <a class="reference internal" href="../reference/reference_boundary_alignment.html#pytadbit.alignment.TAD" title="pytadbit.alignment.TAD"><tt class="xref py py-class docutils literal"><span class="pre">pytadbit.alignment.TAD</span></tt></a>).</p>
<p>The <a class="reference internal" href="../reference/reference_boundary_alignment.html#pytadbit.alignment.Alignment.get_column" title="pytadbit.alignment.Alignment.get_column"><tt class="xref py py-func docutils literal"><span class="pre">pytadbit.alignment.Alignment.get_column()</span></tt></a> function can also take as an argument a function, in
order to select a column (or several) depending on a specific condition. For example, to select all the
boundaries with a score higher than 7:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">cond1</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s">&#39;score&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">7</span>
</pre></div>
</div>
<p>and to the get the selected columns:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">ali</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="n">cond1</span><span class="o">=</span><span class="n">cond1</span><span class="p">)</span>
</pre></div>
</div>
<pre class="ansi-block literal-block">
[(55, [&gt;63800&lt;, &gt;63800&lt;])]
</pre>
<p>resulting, in the selection of these 3 columns.</p>
<p>To add a second condition, e.g. to select only the columns after the 50th column of the alignment:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">cond2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s">&#39;pos&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">50</span>
<span class="n">ali</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="n">cond1</span><span class="o">=</span><span class="n">cond1</span><span class="p">,</span> <span class="n">cond2</span><span class="o">=</span><span class="n">cond2</span><span class="p">)</span>
</pre></div>
</div>
<pre class="ansi-block literal-block">
[(55, [&gt;63800&lt;, &gt;63800&lt;])]
</pre>
<p>Finally, to be more flexible, this conditions can be applied to only a given number of experiments (in this example of a pairwise alignment, it does not make a lot of sense):</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">ali</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="n">cond1</span><span class="o">=</span><span class="n">cond1</span><span class="p">,</span> <span class="n">cond2</span><span class="o">=</span><span class="n">cond2</span><span class="p">,</span> <span class="n">min_num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<pre class="ansi-block literal-block">
[(53, [&gt;60800&lt;, &gt;60800&lt;]), (55, [&gt;63800&lt;, &gt;63800&lt;])]
</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/TADbit_logo_little.png" alt="Logo"/>
            </a></p>
<h3><a href="../index.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installing TADbit on GNU/Linux</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorial.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../tutorial.html#identification-and-analysis-of-tads">Identification and Analysis of TADs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="tutorial_1_general.html">Getting started</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">Alignment of TAD boundaries</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial_3_clustering.html">TAD clustering</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial.html#three-dimentional-modelling">Three-dimentional modelling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../biblio.html">Bibliography</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="tutorial_1_general.html"
                        title="previous chapter">Getting started</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tutorial_3_clustering.html"
                        title="next chapter">TAD clustering</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="tutorial_3_clustering.html" title="TAD clustering"
             >next</a> |</li>
        <li class="right" >
          <a href="tutorial_1_general.html" title="Getting started"
             >previous</a> |</li>
        <li><a href="../index.html">Tadbit 0.1 documentation</a> &raquo;</li>
          <li><a href="../tutorial.html" >Tutorials</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright .
      Last updated on Mar 09, 2015.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div><style>div.related ul {padding-right:150px;}</style>
        <a href="https://github.com/3DGenomes/tadbit" target="_blank"><img
            style="position: absolute; top: 0; right: 0; border: 0;"
            src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
  </body>
</html>