<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Hi-C data processing &mdash; Tadbit 0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../_static/TADbit_icon.ico"/>
    <link rel="top" title="Tadbit 0.1 documentation" href="../index.html" />
    <link rel="up" title="Identification and Analysis of TADs" href="../tutorial.html" />
    <link rel="next" title="Parameter optimization for IMP." href="tutorial_5_parameter_optimization.html" />
    <link rel="prev" title="TAD clustering" href="tutorial_3_clustering.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="tutorial_5_parameter_optimization.html" title="Parameter optimization for IMP."
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="tutorial_3_clustering.html" title="TAD clustering"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Tadbit 0.1 documentation</a> &raquo;</li>
          <li><a href="../tutorial.html" accesskey="U">Identification and Analysis of TADs</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="hi-c-data-processing">
<h1>Hi-C data processing<a class="headerlink" href="#hi-c-data-processing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="data-filtering">
<h2>Data filtering<a class="headerlink" href="#data-filtering" title="Permalink to this headline">¶</a></h2>
<p>To model chromatin structure, we need to ensure that our data is clean enough. The first step is thus to draw the distribution of the sum of interactions per raw/columns in the Hi-C matrix. According to this distribution, we may remove some columns if they present a suspiciously low count of interaction.</p>
<p>Here an example, where &#8220;exp&#8221; is an preloaded Experiment corresponding to human&#8217;s 19th chromosome:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pytadbit</span> <span class="kn">import</span> <span class="n">Chromosome</span>
<span class="kn">from</span> <span class="nn">pytadbit.utils.hic_filtering</span> <span class="kn">import</span> <span class="n">filter_by_mean</span>

<span class="n">my_chrom</span> <span class="o">=</span> <span class="n">Chromosome</span><span class="p">(</span><span class="s">&#39;19&#39;</span><span class="p">)</span>
<span class="n">my_chrom</span><span class="o">.</span><span class="n">add_experiment</span><span class="p">(</span><span class="s">&#39;gm&#39;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
                        <span class="n">hic_data</span><span class="o">=</span><span class="s">&#39;../../scripts/sample_data/HIC_gm06690_chr19_chr19_100000_obs.txt&#39;</span><span class="p">)</span>

<span class="n">exp</span> <span class="o">=</span> <span class="n">my_chrom</span><span class="o">.</span><span class="n">experiments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">zeroes</span> <span class="o">=</span> <span class="n">filter_by_mean</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">get_hic_matrix</span><span class="p">(),</span> <span class="n">draw_hist</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/tutorial_4_data_normalization_3_0.png" src="../_images/tutorial_4_data_normalization_3_0.png" />
<p>Than, according to the fit represented above, we would discard all columns in the Hi-C raw data having cumulative count of interaction below the dashed red line in the graph above (~46). This columns will be removed from the modeling, and their associated particles will have no experimental data.</p>
<p><em>This step is done automatically within tadbit each time an experiment is loaded. In order to ensure that we do remove outlier columns, tadbit checks if this root corresponds to a</em> <strong>concave down</strong> <em>region and if it stands</em> <strong>between zero and the median</strong> <em>of the overall distribution. The result of these &#8220;bad&#8221; columns is stored in the variable Experiment._zeros, that represents the columns to be skipped in the consecutive steps.</em></p>
</div>
<div class="section" id="data-normalization">
<h2>Data normalization<a class="headerlink" href="#data-normalization" title="Permalink to this headline">¶</a></h2>
<p>Hi-C data stored in <a class="reference internal" href="../reference/reference_experiment.html#pytadbit.experiment.Experiment" title="pytadbit.experiment.Experiment"><tt class="xref py py-class docutils literal"><span class="pre">pytadbit.experiment.Experiment</span></tt></a> might be normalized in order to be used by IMP.
This normalization is achieve in two steps, first we generate weight for each pair of interactions, depending on the interaction count in the corresponding row/column, second we calculate the <a class="reference external" href="http://en.wikipedia.org/wiki/Standard_score#Calculation_from_raw_score">z-score</a> of each of these interaction pairs.</p>
<div class="section" id="calculation-of-weights">
<h3>Calculation of weights<a class="headerlink" href="#calculation-of-weights" title="Permalink to this headline">¶</a></h3>
<p>Weights can be calculated according to two formulas (see <a class="reference internal" href="../reference/reference_experiment.html#pytadbit.experiment.Experiment.normalize_hic" title="pytadbit.experiment.Experiment.normalize_hic"><tt class="xref py py-class docutils literal"><span class="pre">pytadbit.experiment.Experiment.normalize_hic</span></tt></a>), however, in the context of three-dimensional modeling, the &#8220;over_tot&#8221; method is recommended, as the distribution of values generated is closer to normal.</p>
<p>Hi-C interaction count are thus normalized according to this formula:</p>
<div class="math">
\[weight(I, J) = \frac{\sum^N_{i=0}{(matrix(i, J))} \times \sum^N_{j=0}{(matrix(I, j))}}{\sum^N_{i=0}{\sum^N_{j=0}{(matrix(i, j))}}}\]</div>
<p>&#8220;matrix&#8221;, being our row data (count of interactions), N the number of rows/columns.</p>
<p>The result is stored in a new matrix, called weight. The values that will be used in the next step are the multiplication of this weights per the raw data.</p>
</div>
<div class="section" id="calculation-of-the-z-score">
<h3>Calculation of the z-score<a class="headerlink" href="#calculation-of-the-z-score" title="Permalink to this headline">¶</a></h3>
<p>Z-scores are computed according to classical formula (<span class="math">\(\frac{x-\mu}{\sigma}\)</span>), over the decimal logarithm values of the normalized data (see above). Ending in this formula:</p>
<div class="math">
\[zscore(I, J) = \frac{log_{10}(weight(I, J) \times matrix(I, J)) - mean(log_{10}(weight \times matrix))}{stddev(log_{10}(weight \times matrix))}\]</div>
<p><strong>Important: values on the diagonal are not taken into account for this calculus.</strong></p>
<div class="section" id="dealing-with-zeros">
<h4>Dealing with zeros<a class="headerlink" href="#dealing-with-zeros" title="Permalink to this headline">¶</a></h4>
<p>A zero in an Hi-C interaction matrix, means that the given two fragments of DNA were never found close enough to be crosslinked together. However such values are also highly suspicious to be artifacts.</p>
<p>Right now we assume that <span class="math">\(log_{10}(0) = 0\)</span>, in the calculation of the mean and stddev, and equal to -1 in the calculation of the z-score itself.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/TADbit_logo_little.png" alt="Logo"/>
            </a></p>
<h3><a href="../index.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installing TADBit on GNU/Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Identification and Analysis of TADs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorial.html#three-dimentional-modelling">Three-dimentional modelling</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="">Hi-C data processing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-filtering">Data filtering</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-normalization">Data normalization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_5_parameter_optimization.html">Parameter optimization for IMP.</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_6_modelling_and_analysis.html">Three-dimensional modeling of chromatine structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_7_single_model_analysis.html">Structural analysis of a chromatin model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../biblio.html">Bibliography</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="tutorial_3_clustering.html"
                        title="previous chapter">TAD clustering</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tutorial_5_parameter_optimization.html"
                        title="next chapter">Parameter optimization for IMP.</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="tutorial_5_parameter_optimization.html" title="Parameter optimization for IMP."
             >next</a> |</li>
        <li class="right" >
          <a href="tutorial_3_clustering.html" title="TAD clustering"
             >previous</a> |</li>
        <li><a href="../index.html">Tadbit 0.1 documentation</a> &raquo;</li>
          <li><a href="../tutorial.html" >Identification and Analysis of TADs</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright .
      Last updated on Nov 13, 2013.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div><style>div.related ul {padding-right:150px;}</style>
        <a href="https://github.com/3DGenomes/tadbit"><img
            style="position: fixed; top: 0; right: 0; border: 0;"
            src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
  </body>
</html>