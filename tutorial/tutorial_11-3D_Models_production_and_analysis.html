<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Modeling a region of the chromatin &#8212; Tadbit 0.1 documentation</title>
    <link rel="stylesheet" href="../_static/forkme_nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/black-on-white.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../_static/TADbit_icon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="TADbit tools" href="../tools.html" />
    <link rel="prev" title="Experimental data assessment and model parameters optimisation" href="tutorial_10-Modeling_parameters_optimization.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../tools.html" title="TADbit tools"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="tutorial_10-Modeling_parameters_optimization.html" title="Experimental data assessment and model parameters optimisation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Tadbit 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../tutorial.html" accesskey="U">Tutorials</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="modeling-a-region-of-the-chromatin">
<h1>Modeling a region of the chromatin<a class="headerlink" href="#modeling-a-region-of-the-chromatin" title="Permalink to this headline">¶</a></h1>
<div class="section" id="load-previous-data">
<h2>Load previous data<a class="headerlink" href="#load-previous-data" title="Permalink to this headline">¶</a></h2>
<p>Load raw data matrices, and normalized matrices</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---------------------------------------------------------------------------</span>

<span class="ne">IOError</span>                                   <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>

<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">14</span><span class="o">-</span><span class="n">bb3edc8b68a8</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
      <span class="mi">3</span>                                    <span class="n">region</span><span class="o">=</span><span class="s1">&#39;chr3&#39;</span><span class="p">,</span>
      <span class="mi">4</span>                                    <span class="n">biases</span><span class="o">=</span><span class="n">bias_path</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cel1</span><span class="p">,</span> <span class="n">reso</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">),</span>
<span class="o">----&gt;</span> <span class="mi">5</span>                                    <span class="n">ncpus</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
      <span class="mi">6</span> <span class="c1">#hic_data2 = load_hic_data_from_bam(base_path.format(cel2),</span>
      <span class="mi">7</span> <span class="c1">#                                   resolution=reso,</span>


<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">dcastillo</span><span class="o">/</span><span class="n">miniconda2</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python2</span><span class="o">.</span><span class="mi">7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">pytadbit</span><span class="o">/</span><span class="n">parsers</span><span class="o">/</span><span class="n">hic_parser</span><span class="o">.</span><span class="n">pyc</span> <span class="ow">in</span> <span class="n">load_hic_data_from_bam</span><span class="p">(</span><span class="n">fnam</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">biases</span><span class="p">,</span> <span class="n">tmpdir</span><span class="p">,</span> <span class="n">ncpus</span><span class="p">,</span> <span class="n">filter_exclude</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="n">clean</span><span class="p">)</span>
    <span class="mi">558</span>     <span class="k">if</span> <span class="n">biases</span><span class="p">:</span>
    <span class="mi">559</span>         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">biases</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
<span class="o">--&gt;</span> <span class="mi">560</span>             <span class="n">biases</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">biases</span><span class="p">))</span>
    <span class="mi">561</span>         <span class="k">if</span> <span class="n">biases</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">resolution</span><span class="p">:</span>
    <span class="mi">562</span>             <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;ERROR: resolution of biases do not match to the &#39;</span>


<span class="ne">IOError</span><span class="p">:</span> <span class="p">[</span><span class="n">Errno</span> <span class="mi">2</span><span class="p">]</span> <span class="n">No</span> <span class="n">such</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">directory</span><span class="p">:</span> <span class="s1">&#39;results/fragment/mouse_B_rep1/04_normalizing/biases_mouse_B_both_100kb.biases&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="modeling">
<h2>Modeling<a class="headerlink" href="#modeling" title="Permalink to this headline">¶</a></h2>
<p>We use the best parameters obtained from the optimization process to
produce an ensemble of models.</p>
<p>From the models produced (n_models) we will tell TADbit to conserve a
number of them (n_keep) that best satisfy the imposed restraints.</p>
<p>The ensemble of models have inherited the description from the
Chromosome object</p>
<p>We still can access to the experiment object from the 3D models:</p>
<p>We can have a look at the data that was used to define restraints:</p>
<img alt="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_20_0.png" src="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_20_0.png" />
<img alt="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_21_0.png" src="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_21_0.png" />
<p>and also visualize how the IMP objective function (OF) of the stored
model improves during the MOnte Carlo optimization:</p>
<img alt="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_23_0.png" src="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_23_0.png" />
</div>
<div class="section" id="structural-models">
<h2>Structural Models<a class="headerlink" href="#structural-models" title="Permalink to this headline">¶</a></h2>
<p>The definition of the “best models” can be changed at any time. Only the
best models will be used in the analysis.</p>
<p>Select top 10 models</p>
<p>Select top 100 models</p>
<p>The ensemble of models “models_B” and “models_PSC” contain the models
generated by the Montecarlo simulation ordered by its Objective Function
(OF). The first model in the list is the one than best satisfies the
imposed restraints.</p>
<p>To get the data for the lowest IMP OF model in the set of models we
retrieve model number 0</p>
<p>We can check the correlation of models_B with the original HiC matrix.</p>
<p>In the plot “Real vs modelled data” we should see a positive correlation
of the contacts in the models with the frequency of interaction of the
pairs of beads in the HiC matrix. High interaction frequency between two
loci in the matrix is reflected by the fact of having a high proportion
of models where the beads representing those two loci are “in contact”
(distance lower than the cutoff).</p>
<img alt="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_33_1.png" src="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_33_1.png" />
<p>To plot all the models in the ensemble we use the view_models function.
By default the centroid (the model closer to the median) is highlighted.</p>
<img alt="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_35_0.png" src="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_35_0.png" />
<p>We can also plot individual models.</p>
<img alt="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_37_0.png" src="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_37_0.png" />
<p>And use Chimera (<a class="reference external" href="https://www.cgl.ucsf.edu/chimera/">https://www.cgl.ucsf.edu/chimera/</a>) for the
visualization of the 3D structure</p>
</div>
<div class="section" id="model-analysis">
<h2>Model analysis<a class="headerlink" href="#model-analysis" title="Permalink to this headline">¶</a></h2>
<div class="section" id="align-models">
<h3>Align models<a class="headerlink" href="#align-models" title="Permalink to this headline">¶</a></h3>
<p>In the Montecarlo simulation each of the models is built starting from a
random initial conformation. Therefore models are not aligned in a
preferred orientation. We can use the function align_models to rotate
and translate the coordinates of the models so they follow the same
orientation as one of the models in the ensemble. By default the model
used as reference is the first one.</p>
<p>With the function deconvolve we obtain a deconvolution analysis of a
given froup of models.It first clusters models based on structural
comparison (dRMSD). Differential contact map between each possible pair
of clusters is shown in the resulting graph. This allows us to detect
common sets of contacts in the ensemble.</p>
</div>
<div class="section" id="deconvolve">
<h3>Deconvolve<a class="headerlink" href="#deconvolve" title="Permalink to this headline">¶</a></h3>
<img alt="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_46_1.png" src="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_46_1.png" />
</div>
<div class="section" id="clustering">
<h3>Clustering<a class="headerlink" href="#clustering" title="Permalink to this headline">¶</a></h3>
<p>The clustering of the models by Markov Cluster Algorith (MCL) or Ward
can be based on different statistics measures (score, rmsd, drmsd or
eqv). By default a score computed as a combination of rmsd, drmsd and
eqv is used.</p>
<p>The analysis dendogram allows us to view the different clusters
population and their OF values.</p>
<img alt="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_51_0.png" src="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_51_0.png" />
<img alt="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_53_0.png" src="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_53_0.png" />
</div>
<div class="section" id="consistency">
<h3>Consistency<a class="headerlink" href="#consistency" title="Permalink to this headline">¶</a></h3>
<p>Model consistency gives a measure of the variability of the particles
accross a set of models. Particles in the same position accross
different models are considered consistent if their distance is less
than the given cutoff.</p>
<img alt="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_56_0.png" src="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_56_0.png" />
<img alt="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_57_0.png" src="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_57_0.png" />
</div>
<div class="section" id="dna-density-plots">
<h3>DNA density plots<a class="headerlink" href="#dna-density-plots" title="Permalink to this headline">¶</a></h3>
  <p>

From the 3D models, the DNA density (or local compactness) can be<p>calculated as the ratio of the bin size (in base pairs) and the
distances between consequtive particles in the models. The higher the
density the more compact DNA for the region. As this measure varies
dramatically from particle to particle, one can calculate it using
running averages.</p>
</p><p><p>In the modelling we have used a scale of 0.01 nm/bp; that means that if
we expect 100 bp/nm of chromatin in each bead and between two
consecutives beads.</p>
</p><img alt="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_60_0.png" src="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_60_0.png" />
<img alt="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_61_0.png" src="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_61_0.png" />
<img alt="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_62_0.png" src="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_62_0.png" />
<img alt="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_63_0.png" src="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_63_0.png" />
</div>
<div class="section" id="walking-angle">
<h3>Walking Angle<a class="headerlink" href="#walking-angle" title="Permalink to this headline">¶</a></h3>
  <p>

Walking\_angle plots the angle between triplets of contiguous<p>particles. The higher are these values the straighter are the models.</p>
</p><img alt="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_66_0.png" src="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_66_0.png" />
</div>
<div class="section" id="particles-interactions">
<h3>Particles interactions<a class="headerlink" href="#particles-interactions" title="Permalink to this headline">¶</a></h3>
  <p>

We can plot for each particle the number of interactions (particles<p>closer than the given cutoff)</p>
</p><img alt="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_69_0.png" src="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_69_0.png" />
<img alt="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_70_0.png" src="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_70_0.png" />
</div>
<div class="section" id="accessibility">
<h3>Accessibility<a class="headerlink" href="#accessibility" title="Permalink to this headline">¶</a></h3>
  <p>

The accessibility is calculated by considering a mesh surface around<p>the model and checking if each point of this mesh could be replaced by
an object (i.e. a protein) represented as a sphere of a given radius.</p>
</p><p><p>Outer part of the model can be excluded from the estimation of
accessible surface because contacts from this outer part to particles
outside the model are unknown. To exclude the outer contour a sphere
with a higher radius (superradius) is first tested in the mesh before
proceding to the accessibility calculation.</p>
</p><img alt="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_73_0.png" src="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_73_0.png" />
<img alt="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_74_0.png" src="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_74_0.png" />
</div>
<div class="section" id="calculating-distances-between-particles">
<h3>Calculating distances between particles<a class="headerlink" href="#calculating-distances-between-particles" title="Permalink to this headline">¶</a></h3>
<p>To inspect the distance between two particles in the models we can use
the median_3d_dist function which give us not only the median distance
considering all the models but also an histogram of the different values
accross them.</p>
<img alt="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_78_0.png" src="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_78_0.png" />
<img alt="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_79_0.png" src="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_79_0.png" />
<p>The median distance can be calculated only in one of the clusters or in
a set of models.</p>
<img alt="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_81_0.png" src="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_81_0.png" />
<img alt="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_82_0.png" src="tutorial/../nbpictures//tutorial_11-3D_Models_production_and_analysis_82_0.png" />
<p>The Structural Models object can be saved and retrieved at a later stage</p>
<p>Other information can also be saved independently like the contacts map
as a bed-like file, the models either as a xyz bed-like file or as cmm
to visualize with Chimera.</p>
<p>We can also export the models and clusters to a JSON for a later
inspection with TADkit (<a class="reference external" href="http://sgt.cnag.cat/3dg/tadkit/">http://sgt.cnag.cat/3dg/tadkit/</a>)</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/TADbit_logo_little.png" alt="Logo"/>
            </a></p>
<h3><a href="../index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installing TADbit on GNU/Linux under conda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html#software">Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html#installing-tadbit-on-gnu-linux">Installing TADbit on GNU/Linux</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorial.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../tutorial.html#from-fastq-files-to-interaction-matrices">From FASTQ files to interaction matrices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial.html#identification-and-analysis-of-tads-and-compartments">Identification and Analysis of TADs and Compartments</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../tutorial.html#three-dimentional-modelling">Three-dimentional modelling</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="tutorial_10-Modeling_parameters_optimization.html">Experimental data assessment and model parameters optimisation</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Modeling a region of the chromatin</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools.html">TADbit tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../biblio.html">Bibliography</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="tutorial_10-Modeling_parameters_optimization.html"
                        title="previous chapter">Experimental data assessment and model parameters optimisation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../tools.html"
                        title="next chapter">TADbit tools</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../tools.html" title="TADbit tools"
             >next</a> |</li>
        <li class="right" >
          <a href="tutorial_10-Modeling_parameters_optimization.html" title="Experimental data assessment and model parameters optimisation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Tadbit 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../tutorial.html" >Tutorials</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright .
      Last updated on Jun 21, 2019.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div><style>div.related ul {padding-right:150px;}</style>
        <a href="https://github.com/3DGenomes/tadbit" target="_blank"><img
            style="position: absolute; top: 0; right: 0; border: 0;"
            src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
  </body>
</html>